Домашнее задание
Работа с join'ами, статистикой

Цель:
знать и уметь применять различные виды join'ов
строить и анализировать план выполнения запроса
оптимизировать запрос
уметь собирать и анализировать статистику для таблицы

Описание/Пошаговая инструкция выполнения домашнего задания:
В результате выполнения ДЗ вы научитесь пользоваться
различными вариантами соединения таблиц.
В данном задании тренируются навыки: написание запросов с различными типами соединений

*Домашнее задание буду выполнять на базе flights, взятой с сайта [PostgresPro](https://postgrespro.ru/education/demodb)

*Схема базы данных
<kbd>
  <img src="https://github.com/AleksMinin/otus-pgsql-dba-dev/raw/main/HomeWork_13/images/schema_db.jpg" alt="Схема БД" caption="Схема БД"/>
</kbd>

* Самой удобной шпаргалкой по JOIN-ам когда-то была эта картинка
<kbd>
  <img src="https://github.com/AleksMinin/otus-pgsql-dba-dev/raw/main/HomeWork_13/images/SQL_JOINS.png" alt="Схема БД" caption="Схема БД"/>
</kbd>

* Необходимо:
1. Реализовать прямое соединение двух или более таблиц
* Прямое соединение - JOIN, или INNER JOIN, позволяет получить содержимое, имеющееся одновременно в обеих таблицах
```sql
-- Выбрать информацию о рейсах на которых летела Аделина Александрова
select t.passenger_name as  psngr_name,
       json_extract_path_text(t.contact_data::json, 'phone') as psngr_phone,
       tf.ticket_no,
       f.flight_no,
       f.scheduled_departure
  from tickets t  
 inner join ticket_flights tf on tf.ticket_no = t.ticket_no
 inner join flights f on tf.flight_id = f.flight_id
 where t.passenger_name = 'ADELINA ALEKSANDROVA'
 order by 1, 5
 
 psngr_name          |psngr_phone |ticket_no    |flight_no|scheduled_departure          |
--------------------+------------+-------------+---------+-----------------------------+
ADELINA ALEKSANDROVA|+70614565587|0005432335984|PG0476   |2017-07-29 11:45:00.000 +0500|
ADELINA ALEKSANDROVA|+70614565587|0005432335984|PG0251   |2017-07-29 20:05:00.000 +0500|
ADELINA ALEKSANDROVA|+70614565587|0005432335984|PG0252   |2017-08-11 15:05:00.000 +0500|
ADELINA ALEKSANDROVA|+70614565587|0005432335984|PG0472   |2017-08-11 20:30:00.000 +0500|
```


2. Реализовать левостороннее (или правостороннее) соединение двух или более таблиц
* Правостороннее отличается от левостороннего лишь тем, что таблицы будут стоять в блоке ON в обратном порядке. Правостороннее соединение практически не используется на практике.
* Левостороннее соединение - LEFT JOIN, либо LEFT OUTER JOIN, позволяет получить содержимое присутствующее как одновременно и в левой и в правой таблице, так и присутствующее в левой и при этом отсутствующее в правой
```sql
-- Выбрать самолеты со всеми запланированными вылетами по трем моделям самолетов, с указанием города и аэропорта назначения.
-- В том числе и те самолеты, по которым вылетов запланировано не было
select a.model, ad."range", f.scheduled_departure, ap2.city, ap2.airport_name
  from aircrafts a
 inner join aircrafts_data ad on ad.aircraft_code = a.aircraft_code
  left join flights f on a.aircraft_code = f.aircraft_code
  left join airports_data ap on f.arrival_airport = ap.airport_code
  left join airports ap2 on ap.airport_code = ap2.airport_code
 where a.model in ('Аэробус A320-200','Боинг 767-300','Сухой Суперджет-100')
 order by a.model, f.scheduled_departure
 limit 5
  
model           |range|scheduled_departure          |city                |airport_name|
----------------+-----+-----------------------------+--------------------+------------+
Аэробус A320-200| 5700|                             |                    |            |
Боинг 767-300   | 7900|2017-05-17 07:05:00.000 +0500|Санкт-Петербург     |Пулково     |
Боинг 767-300   | 7900|2017-05-17 09:00:00.000 +0500|Екатеринбург        |Кольцово    |
Боинг 767-300   | 7900|2017-05-17 09:10:00.000 +0500|Комсомольск-на-Амуре|Хурба       |
Боинг 767-300   | 7900|2017-05-17 11:15:00.000 +0500|Москва              |Домодедово  |  

-- Выбрать все самолеты, по которым не было запланировано рейсов совсем (самолет еще не использовался)
select a.model
  from aircrafts a
  left join flights f on a.aircraft_code = f.aircraft_code
 where f.scheduled_departure is null

model           |
----------------+
Аэробус A320-200|  
``` 
3. Реализовать кросс соединение двух или более таблиц
* CROSS JOIN Результатом такого соединения будет объединение каждой строки первой таблицы с каждой строкой второй таблицы (Декартово произведение).
```sql
-- Получить все варианты самолетов со всеми вариантами городов
select a.model , a2.city 
  from aircrafts a 
 cross join airports a2 
 limit 20
 
model              |city     |
-------------------+---------+
Боинг 777-300      |Якутск   |
Боинг 767-300      |Якутск   |
Сухой Суперджет-100|Якутск   |
Аэробус A320-200   |Якутск   |
Аэробус A321-200   |Якутск   |
Аэробус A319-100   |Якутск   |
Боинг 737-300      |Якутск   |
Сессна 208 Караван |Якутск   |
Бомбардье CRJ-200  |Якутск   |
Боинг 777-300      |Мирный   |
Боинг 767-300      |Мирный   |
Сухой Суперджет-100|Мирный   |
Аэробус A320-200   |Мирный   |
Аэробус A321-200   |Мирный   |
Аэробус A319-100   |Мирный   |
Боинг 737-300      |Мирный   |
Сессна 208 Караван |Мирный   |
Бомбардье CRJ-200  |Мирный   |
Боинг 777-300      |Хабаровск|
Боинг 767-300      |Хабаровск| 
```
* Вкусный пример CROSS JOIN
<kbd>
  <img src="https://github.com/AleksMinin/otus-pgsql-dba-dev/raw/main/HomeWork_13/images/dinner.png"/>
</kbd>
4. Реализовать полное соединение двух или более таблиц
* FULL JOIN, либо FULL OUTER JOIN . Возвращаются совпадающие записи, а также записи, которые не совпадают. Несовпадающие записи будут иметь идентификатор со значением NULL из таблицы, к которой присоединена запись, поскольку это запись, которая не имеет совпадений в другой таблицей.
```sql
-- Выбрать все самолеты, кто и в каком месяце совершал перелеты
select a.model, to_char(f.scheduled_departure,'MONTH') as sMonth
  from flights f
  full join aircrafts a on f.aircraft_code = a.aircraft_code
 group by 1,2 
 limit 10
 
 model              |smonth   |
-------------------+---------+
Боинг 767-300      |JUNE     |
Боинг 777-300      |MAY      |
Аэробус A321-200   |SEPTEMBER|
Аэробус A319-100   |SEPTEMBER|
Боинг 777-300      |AUGUST   |
Аэробус A320-200   |         |
Боинг 737-300      |MAY      |
Сухой Суперджет-100|JUNE     |
Боинг 737-300      |JUNE     |
Сухой Суперджет-100|MAY      |
```
5. Реализовать запрос, в котором будут использованы разные типы соединений
* Повторю запрос из третьего пункта, как раз он попадает под условия задания
```sql
-- Выбрать самолеты со всеми запланированными вылетами по трем моделям самолетов, с указанием города и аэропорта назначения.
-- В том числе и те самолеты, по которым вылетов запланировано не было
select a.model, ad."range", f.scheduled_departure, ap2.city, ap2.airport_name
  from aircrafts a
 inner join aircrafts_data ad on ad.aircraft_code = a.aircraft_code
  left join flights f on a.aircraft_code = f.aircraft_code
  left join airports_data ap on f.arrival_airport = ap.airport_code
  left join airports ap2 on ap.airport_code = ap2.airport_code
 where a.model in ('Аэробус A320-200','Боинг 767-300','Сухой Суперджет-100')
 order by a.model, f.scheduled_departure
 limit 5
  
model           |range|scheduled_departure          |city                |airport_name|
----------------+-----+-----------------------------+--------------------+------------+
Аэробус A320-200| 5700|                             |                    |            |
Боинг 767-300   | 7900|2017-05-17 07:05:00.000 +0500|Санкт-Петербург     |Пулково     |
Боинг 767-300   | 7900|2017-05-17 09:00:00.000 +0500|Екатеринбург        |Кольцово    |
Боинг 767-300   | 7900|2017-05-17 09:10:00.000 +0500|Комсомольск-на-Амуре|Хурба       |
Боинг 767-300   | 7900|2017-05-17 11:15:00.000 +0500|Москва              |Домодедово  |  
```

Сделать комментарии на каждый запрос
К работе приложить структуру таблиц, для которых
выполнялись соединения